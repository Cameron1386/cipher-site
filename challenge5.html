<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Challenge 5</title>
  <link rel="stylesheet" href="styles.css">
  <script src="substitution.js" defer></script>
</head>
<body>
  <h1>Welcome to Challenge 5</h1>
  <p>To solve this you just need to replace one letter for another, guessing based on frequency</p>
  <form>
    <input class="challenge-in" type="text" id="cipher" placeholder="[Decoded Text]" required>
    <button type="button" onclick="validateAndRedirect()">Submit</button>
  </form>

  <div><em>Use this tool to decrypt the message, one letter can take the place of another, refresh to restart</em></div>
  <div id="container"></div>

  <button id="chal-5">Test</button>

  <div id="string">Qeb cixd zxk lcqbk yb exoa ql cfka fk x prypqfqrqflk zfmebo, yrq fq grpq qxhbp [mXqf3Kz3]. Fc vlr illh zilpbiv xq qeb mxqqbokp xka cobnrbkzfbp lc qeb ibqqbop, vlr'ii pqxoq ql pbb efkqp. Pljb ibqqbop xmmbxo jlob lcqbk qexk lqebop, xka zboqxfk zljyfkxqflkp tfii pqxka lrq. Pqxv clzrpba, qxhb vlro qfjb, xka bsbkqrxiiv, qeb jbppxdb tfii obsbxi fqpbic.</div>


  <script>
  const urlParams = new URLSearchParams(window.location.search);
  const passedToken = urlParams.get('token');
  const storedToken = sessionStorage.getItem('challenge4Token');

  if ((passedToken !== storedToken) || passedToken == null) {
    alert("BAD!!");
    window.location.href = 'challenge1.html';
  }

    function validateAndRedirect() {
      const input = document.getElementById("cipher").value;

      const token = Math.random().toString(36).slice(2);  // random token
      sessionStorage.setItem('challenge5Token', token);

      if (input === atob("W3BBdGkzTmMzXQ==")) {
        document.body.style.backgroundColor = "lightgreen"
        setTimeout(() => {
        window.location.href = `end.html?token=${token}`;
      }, 1000);
      } else {
          document.body.style.backgroundColor = "rgb(255, 80, 80)";
          setTimeout(() => {
            document.body.style.backgroundColor = "";
        }, 500);
      }
    }



  </script>
</body>
</html>
